{% extends "components/base.html" %}
{% block content %}
<div class="mx-auto max-w-7xl px-3 sm:px-4 lg:px-8 py-10">

  <!-- Header / Filters -->
  <div class="flex flex-col gap-4 sm:flex-row sm:items-end sm:justify-between mb-6">
    <div>
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Products</h1>
      <p class="text-gray-600 dark:text-gray-300">Explore our catalog.</p>
    </div>

    <form method="get" class="flex flex-wrap items-center gap-2">
      <input name="q" value="{{ q }}" placeholder="Search products"
             class="w-56 rounded-md bg-white py-2 pl-3 pr-3 text-sm text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-[var(--color-primary)] dark:bg-white/5 dark:text-white dark:outline-white/10" />
      <select name="category"
              class="rounded-md bg-white py-2 pl-3 pr-8 text-sm text-gray-900 outline-1 -outline-offset-1 outline-gray-300 focus:outline-2 focus:-outline-offset-2 focus:outline-[var(--color-primary)] dark:bg-white/5 dark:text-white dark:outline-white/10">
        <option value="">All categories</option>
        {% for c in categories %}
          <option value="{{ c }}" {% if c == category %}selected{% endif %}>{{ c }}</option>
        {% endfor %}
      </select>
      <button class="rounded-md bg-[var(--color-primary)] px-3.5 py-2 text-sm font-semibold text-white">Filter</button>
      <a href="{% url 'products:list' %}" class="text-sm text-gray-600 dark:text-gray-300 underline">Reset</a>
    </form>
  </div>

  <!-- Grid -->
  <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
    {% for p in products %}
      <a href="{% url 'products:detail' p.slug %}"
         class="group overflow-hidden rounded-xl bg-white ring-1 ring-black/5 shadow-sm hover:shadow-md transition dark:bg-gray-900 dark:ring-white/10">
        <div class="aspect-[4/3] bg-gray-50 dark:bg-gray-800">
          {% if p.image %}
            <img src="{{ p.image.url }}" alt="{{ p.name }}" class="h-full w-full object-cover transition group-hover:scale-105">
          {% else %}
            <div class="flex h-full w-full items-center justify-center text-gray-400">No Image</div>
          {% endif %}
        </div>
        <div class="p-4">
          <div class="flex items-center justify-between">
            <h2 class="text-base font-semibold text-gray-900 dark:text-white">{{ p.name }}</h2>

          </div>
          {% if p.short_description %}
            <p class="mt-1 text-sm text-gray-600 line-clamp-2 dark:text-gray-300">{{ p.short_description }}</p>
          {% endif %}
          {% if p.category %}
            <span class="mt-3 inline-flex items-center rounded-full bg-amber-700/10 px-2 py-0.5 text-xs font-medium text-amber-700 ring-1 ring-amber-700/30">
              {{ p.category }}
            </span>
          {% endif %}
        </div>
      </a>
    {% empty %}
      <p class="text-gray-600 dark:text-gray-300">No products found.</p>
    {% endfor %}
  </div>

  <!-- Pagination -->
  {% if products.paginator.num_pages > 1 %}
    <div class="mt-8 flex items-center justify-center gap-2">
      {% if products.has_previous %}
        <a class="rounded-md px-3 py-1 ring-1 ring-black/10 dark:ring-white/10" href="?page={{ products.previous_page_number }}&q={{ q }}&category={{ category }}">Prev</a>
      {% else %}
        <span class="rounded-md px-3 py-1 text-gray-400 ring-1 ring-black/10 dark:ring-white/10">Prev</span>
      {% endif %}
      <span class="px-2 text-sm text-gray-600 dark:text-gray-300">
        Page {{ products.number }} of {{ products.paginator.num_pages }}
      </span>
      {% if products.has_next %}
        <a class="rounded-md px-3 py-1 ring-1 ring-black/10 dark:ring-white/10" href="?page={{ products.next_page_number }}&q={{ q }}&category={{ category }}">Next</a>
      {% else %}
        <span class="rounded-md px-3 py-1 text-gray-400 ring-1 ring-black/10 dark:ring-white/10">Next</span>
      {% endif %}
    </div>
  {% endif %}

  <!-- Admin/owner actions (optional) -->
  <div class="mt-10">
    <a href="{% url 'products:create' %}" class="inline-flex items-center gap-2 rounded-md bg-amber-700 px-3.5 py-2.5 text-white">
      Add Product
      <svg viewBox="0 0 24 24" class="size-4" fill="none" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16M4 12h16"/>
      </svg>
    </a>
  </div>
</div>
{% endblock %}
