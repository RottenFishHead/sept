{% extends "components/base.html" %}
{% load static %}

{% block content %}
<div class="max-w-4xl mx-auto p-8 bg-white shadow-lg rounded-xl border border-gray-200">

  <h2 class="text-2xl font-bold mb-6 text-gray-800">
    {% if form.instance.pk %} Edit Product {% else %} Add Product {% endif %}
  </h2>

  <form method="post" enctype="multipart/form-data" class="space-y-8">
    {% csrf_token %}

    {% for field in form %}
      <div>
        <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
          {{ field.label }}
        </label>

        {# Special styling for ImageFields #}
        {% if field.field.widget.input_type == "file" %}
          <div class="flex items-center space-x-4">
            <label class="cursor-pointer inline-flex items-center px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-md shadow hover:bg-indigo-700 transition">
              Upload
              {{ field }}
            </label>
          </div>

          {# If editing & already has image, show preview #}
          {% if form.instance.pk and field.value %}
            <div class="mt-3">
              <img src="{{ field.value.url }}" alt="{{ field.label }}" class="max-h-40 rounded shadow">
              <p class="text-xs text-gray-500 mt-1">Current file: {{ field.value.name }}</p>
              {# Django automatically shows the "Clear" checkbox if widget is ClearableFileInput #}
            </div>
          {% endif %}
        {% else %}
          {{ field }}
        {% endif %}

        {% if field.help_text %}
          <p class="text-xs text-gray-500 mt-1">{{ field.help_text }}</p>
        {% endif %}
        {% if field.errors %}
          <p class="text-red-500 text-sm mt-1">{{ field.errors|striptags }}</p>
        {% endif %}
      </div>
    {% endfor %}

    <!-- Submit -->
    <div class="pt-6">
      <button type="submit" 
        class="w-full py-3 px-6 rounded-lg bg-green-600 text-white font-semibold shadow hover:bg-green-700 transition">
        Save Product
      </button>
    </div>
  </form>
</div>
{% endblock %}
